import{J as e,f as l,q as a,r as t,R as n,v as r,a as c}from"./vendor.02ad2195.js";const u={capsule:"capsule_184x69.jpg",header:"header.jpg",library:"library_600x900.jpg"},o={"capsule-fallback":["capsule"],"header-fallback":["header","capsule"],"library-fallback":["library","header","capsule"]};const s=e=>e.endsWith("-fallback"),i=async(e,l)=>o[l].reduce((async(l,a)=>await l||await m(e,a)),Promise.resolve(null)),m=(e,l)=>fetch(p(e,l)).then((e=>e.blob())).then((e=>({blob:e,type:l}))).catch((()=>null)),p=(e,l)=>`https://cdn.akamai.steamstatic.com/steam/apps/${e}/${u[l]}`,d=async(l,a="capsule")=>{const t=[],n=[],r=l.map((async({appid:e,name:l})=>{var r;const c=await function(e,l){return s(l)?i(e,l):m(e,l)}(e,a),u=a.replace(/-fallback$/,"");let o;if(c?(t.push({appid:e,name:l,image:c}),o=u===c.type?null:"FALLBACK_FOUND"):o="ALL_NOT_FOUND",o){const a=(e=>({capsule:p(e,"capsule"),header:p(e,"header"),library:p(e,"library")}))(e);n.push({failType:o,appid:e,name:l,actualType:null!=(r=null==c?void 0:c.type)?r:null,expectedType:u,allImageUrls:a})}}));await Promise.all(r);const c=new e;t.forEach((({name:e,image:l})=>{c.file(h(`${e}.jpg`),l.blob,{binary:!0})}));return{zipBlob:await c.generateAsync({type:"blob"}),fails:n}},h=e=>l(e,{replacement:"_"}).replace(/_+/g,"_");function b(e){const{parse:l,stringify:a}=e;return function({onData:e,defaultValue:r}){const c=t.exports.useMemo((()=>{try{return r?a(r):void 0}catch(e){return}}),[]);return n.createElement(g,{defaultValue:c,onChange:a=>{try{const t=l(a.currentTarget.value);t&&e(t)}catch(t){}}})}}const g=a.textarea`
  display: block;
  width: 500px;
  height: 200px;
`;function f(e,l){return t.exports.useState(l)}const y=[{value:"capsule",label:"1. 一番小さい 横長"},{value:"header",label:"2. 少し大きめ 横長"},{value:"library",label:"3. 大きめ 縦長"},{value:"library-fallback",label:"3 → 2 → 1 の順で画像があるものを使う"},{value:"header-fallback",label:"2 → 1 の順で画像があるものを使う"}];function E({disabled:e,value:l,onChange:a}){return n.createElement(v,null,"画像サイズ:"," ",n.createElement("select",{disabled:e,value:l,onChange:e=>{a(e.currentTarget.value)}},y.map((({value:e,label:l})=>n.createElement("option",{key:e,value:e,label:l})))))}const v=a.label`
  display: block;
`;function x({games:e,zipFilename:l}){const[a,r]=t.exports.useState("library"),[c,u]=t.exports.useState([]),[o,s]=t.exports.useState(!1),[i,m]=t.exports.useState(null),p=0===e.length||o,b=!i||o;return n.createElement("div",null,n.createElement(E,{disabled:p,value:a,onChange:e=>r(e)}),n.createElement(C,{disabled:p,onClick:()=>{s(!0),d(e,a).then((({zipBlob:e,fails:l})=>{m(e),u(l)})).then((()=>s(!1))).catch((()=>s(!1)))},children:"Generate"}),n.createElement(C,{disabled:b,onClick:()=>{s(!0),((e,l)=>{const a=document.createElement("a"),t=URL.createObjectURL(e);return a.href=t,a.download=h(l),document.body.appendChild(a),a.click(),new Promise((e=>{setTimeout((function(){document.body.removeChild(a),window.URL.revokeObjectURL(t),e()}),0)}))})(i,l).then((()=>s(!1))).catch((()=>s(!1)))},children:"Download"}),n.createElement("hr",null),c.map((({appid:e,name:l,actualType:a,expectedType:t,failType:r,allImageUrls:c})=>n.createElement("div",{key:e},"'",l,"'は'",t,"'でのダウンロードを試みましたが",{FALLBACK_FOUND:`'${a}'をダウンロードしました。`,ALL_NOT_FOUND:"ファイルが見つかりませんでした。"}[r],n.createElement("img",{src:c.capsule,alt:""}),n.createElement("img",{src:c.header,alt:""}),n.createElement("img",{src:c.library,alt:""}),n.createElement("hr",null)))))}const C=a.button``;function k({value:e,allItemCount:l,categoryMap:a,onChange:r}){const c=t.exports.useMemo((()=>{const e=[{value:"",label:`ALL - ${l} items`}];return a.forEach((({length:l},a)=>{e.push({value:a,label:`${a} - ${l} items`})})),e}),[l,a]);return n.createElement(w,null,"カテゴリー:"," ",n.createElement("select",{value:e||"",onChange:e=>{r(e.currentTarget.value||null)}},c.map((({value:e,label:l})=>n.createElement("option",{key:e,value:e,label:l})))))}const w=a.label`
  display: block;
`,S=b({parse:e=>{var l,a,t,n,c;try{const u=r.parse(e);return null!=(c=null==(n=null==(t=null==(a=null==(l=null==u?void 0:u.UserRoamingConfigStore)?void 0:l.Software)?void 0:a.Valve)?void 0:t.Steam)?void 0:n.Apps)?c:null}catch(u){return null}},stringify:e=>{const l={UserRoamingConfigStore:{Software:{Valve:{Steam:{Apps:e}}}}};return r.stringify(l)}}),L=b({parse:e=>{try{const l=JSON.parse(e);return Array.isArray(l)?l:null}catch(l){return null}},stringify:JSON.stringify});function A(){const[e,l]=f(0,{}),[a,r]=f(0,[]),[c,u]=t.exports.useState(null),o=t.exports.useMemo((()=>(e=>{const l=new Map;return Object.entries(e).forEach((([e,{tags:a}])=>{Object.values(a||{}).forEach((a=>{const t=l.get(a)||[];t.push(e),l.set(a,t)}))})),l})(e)),[e]),s=t.exports.useMemo((()=>c?((e,l,a)=>{const t=e.get(l)||[];return t.length?a.filter((({appid:e})=>t.includes(`${e}`))):[]})(o,c,a):[...a]),[c,o,a]);return n.createElement(U,null,n.createElement("h2",null,"1. ",n.createElement("code",null,"sharedconfig.vdf")," を読み込む"),n.createElement(O,null,n.createElement("li",null,n.createElement("code",null,'"Program Files (x86)"/Steam/userdata/',"{","StaemのユーザーID","}","/7/remote/"),"にある",n.createElement("code",null,"sharedconfig.vdf"),"をメモ帳等で開く。"),n.createElement("li",null,"その中身をすべてコピーしこのテキストボックスに貼り付ける。")),n.createElement(S,{defaultValue:e,onData:e=>{l(e)}}),n.createElement("h2",null,"2. 自分のプロフィールページからゲームのデータを読み込む"),n.createElement(O,null,n.createElement("li",null,"SteamをWebブラウザで開き、ログインする。(Chrome推奨)"),n.createElement("li",null,"次に自分のプロフィールページに飛び、右側のメニューの中からゲーム一覧を開く。 (自分のプロフィールページのURLの末尾に",n.createElement("code",null,"/games/?tab=all"),"を追加することでも開けます。)"),n.createElement("li",null,n.createElement("code",null,"F12"),"キー（または",n.createElement("code",null,"Ctrl+Alt+I"),"）でブラウザの開発者ツールを開き、開発者ツール内上部のタブ一覧から",n.createElement("code",null,"Console"),"というタブを選択する。"),n.createElement("li",null,n.createElement("a",{href:"https://raw.githubusercontent.com/whatasoda/steam-thumbnail-collector/main/collect-game-data.js"},"このページ"),"にあるスクリプトをコピーして先程開いたコンソールに貼り付ける。"),n.createElement("li",null,"自動的にゲームのデータがクリップボードにコピーされるので、それをこのテキストボックスに貼り付ける。")),n.createElement(L,{defaultValue:a,onData:e=>{r(e)}}),n.createElement("h2",null,"3. カテゴリーと画像サイズを選んで生成！"),n.createElement(k,{value:c,categoryMap:o,allItemCount:a.length,onChange:e=>{u(e)}}),n.createElement(x,{zipFilename:`${c||"AllGames"}.zip`,games:s}))}const U=a.div`
  padding-bottom: 50%;
`,O=a.ol`
  padding-left: 25px;
  code {
    white-space: pre;
    padding: 4px;
    background-color: #ccc;
    border-radius: 4px;
  }
`;c.render(n.createElement(A,null),document.querySelector("#app"));
